# 运动记录功能使用说明

## 功能概述

iCyclist 应用现在支持完整的运动记录功能，可以记录您的骑行轨迹、时间、距离等数据，并自动生成轨迹缩略图。

## 主要功能

### 1. 开始运动
- 点击"开始运动"按钮开始记录
- 应用会自动记录GPS轨迹点
- 实时计算距离、速度等数据
- 在地图上实时绘制运动轨迹（蓝色线条）

### 2. 运动中
- 轨迹会以2秒间隔自动记录GPS位置点
- 过滤精度差的点（>50米）
- 过滤异常距离点（防止GPS漂移）
- 实时更新地图上的轨迹线

### 3. 结束运动
- **长按**红色的"结束运动"按钮来停止记录
- 自动生成轨迹缩略图
- 保存运动数据到本地数据库
- 显示在运动记录列表中

## 记录的数据

每次运动会记录以下数据：
- **日期时间**：运动开始的时间
- **用时**：运动持续时长（HH:mm:ss格式）
- **距离**：总骑行距离（公里）
- **平均速度**：全程平均速度（km/h）
- **最大速度**：运动过程中的最高速度
- **GPS轨迹**：所有记录的GPS坐标点
- **轨迹缩略图**：自动生成的轨迹预览图
- **卡路里**：估算消耗的卡路里

## 轨迹缩略图

轨迹缩略图包含：
- 浅灰色背景
- 蓝色轨迹线
- 绿色起点标记
- 红色终点标记
- 自动调整比例以适应缩略图大小

## 数据存储

- 使用 Room 数据库本地存储
- 轨迹缩略图保存为 PNG 文件
- 数据库文件：`sport_database`
- 缩略图保存在应用私有目录

## 技术实现

### 数据库架构
- **Entity**: `SportRecordEntity` - 运动记录实体
- **DAO**: `SportRecordDao` - 数据访问对象
- **Database**: `SportDatabase` - Room数据库

### GPS定位
- 使用高德地图定位SDK
- 高精度定位模式
- 2秒定位间隔
- 运动场景优化

### 距离计算
- 使用 Haversine 公式计算两点间距离
- 考虑地球曲率
- 精确到米级

### 轨迹绘制
- 使用高德地图 Polyline 绘制实时轨迹
- 缩略图使用 Canvas 绘制
- 自动缩放以适应不同的轨迹范围

## 权限要求

应用需要以下权限：
- `ACCESS_FINE_LOCATION` - 精确定位
- `ACCESS_COARSE_LOCATION` - 粗略定位
- `ACCESS_BACKGROUND_LOCATION` - 后台定位（Android 10+）

## 使用提示

1. **GPS信号**：确保在户外或GPS信号良好的地方使用
2. **精度过滤**：应用会自动过滤精度差于50米的点
3. **长按结束**：需要长按结束按钮才能停止运动（防止误触）
4. **最小轨迹**：至少需要2个有效轨迹点才能保存记录
5. **电池优化**：运动记录会持续使用GPS，注意电量消耗

## 未来改进方向

- [ ] 添加暂停/继续功能
- [ ] 支持导出GPX格式
- [ ] 添加运动统计图表
- [ ] 支持分享运动记录
- [ ] 添加语音播报
- [ ] 支持多种运动类型
- [ ] 添加目标设定功能

## 已知限制

- 室内GPS信号弱，可能无法准确记录
- 高楼密集区域可能有GPS漂移
- 轨迹缩略图为静态图片，不支持交互
- 暂不支持后台运动记录
